<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>7&nbsp;Miscellaneous Notes and Utilities</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Crypto:<span class="mywbr"> &nbsp;</span> Cryptographic Operations</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" data-pltdoc="x">Introduction to the Crypto Library</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="factory.html" class="tocviewlink" data-pltdoc="x">Cryptography Factories</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="digest.html" class="tocviewlink" data-pltdoc="x">Message Digests</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="cipher.html" class="tocviewlink" data-pltdoc="x">Symmetric Encryption</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="pk.html" class="tocviewlink" data-pltdoc="x">Public-<wbr></wbr>Key Cryptography</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="kdf.html" class="tocviewlink" data-pltdoc="x">Key Derivation and Password Hashing</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Miscellaneous Notes and Utilities</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>7&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Miscellaneous Notes and Utilities</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">7.1&nbsp;</td><td><a href="#%28part._input%29" class="tocviewlink" data-pltdoc="x">Input to Cryptographic Operations</a></td></tr><tr><td align="right">7.2&nbsp;</td><td><a href="#%28part._provider-notes%29" class="tocviewlink" data-pltdoc="x">Notes on Cryptography Providers</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">7.1<tt>&nbsp;</tt></span><a href="#%28part._input%29" class="tocsubseclink" data-pltdoc="x">Input to Cryptographic Operations</a></td></tr><tr><td><a href="#%28def._%28%28lib._crypto%2Fmain..rkt%29._input%2Fc%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">input/<span class="mywbr"> &nbsp;</span>c</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._crypto%2Fmain..rkt%29._bytes-range%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">bytes-<wbr></wbr>range</span></span></a></td></tr><tr><td><span class="tocsublinknumber">7.2<tt>&nbsp;</tt></span><a href="#%28part._provider-notes%29" class="tocsubseclink" data-pltdoc="x">Notes on Cryptography Providers</a></td></tr><tr><td><span class="tocsublinknumber">7.2.1<tt>&nbsp;</tt></span><a href="#%28part._random%29" class="tocsubseclink" data-pltdoc="x">CSPRNG Initialization</a></td></tr><tr><td><span class="tocsublinknumber">7.2.2<tt>&nbsp;</tt></span><a href="#%28part._libcrypto-notes%29" class="tocsubseclink" data-pltdoc="x">Libcrypto Quirks</a></td></tr><tr><td><span class="tocsublinknumber">7.2.3<tt>&nbsp;</tt></span><a href="#%28part._gcrypt-notes%29" class="tocsubseclink" data-pltdoc="x">GCrypt Quirks</a></td></tr><tr><td><span class="tocsublinknumber">7.2.4<tt>&nbsp;</tt></span><a href="#%28part._sodium-notes%29" class="tocsubseclink" data-pltdoc="x">Sodium Quirks</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="kdf.html" title="backward to &quot;6 Key Derivation and Password Hashing&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Crypto: Cryptographic Operations&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h3>7<tt>&nbsp;</tt><a name="(part._misc)"></a>Miscellaneous Notes and Utilities</h3><h4>7.1<tt>&nbsp;</tt><a name="(part._input)"></a>Input to Cryptographic Operations</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._crypto/main..rkt)._input/c))"></a><span title="Provided from: crypto | Package: crypto-lib"><span class="RktSym"><a href="#%28def._%28%28lib._crypto%2Fmain..rkt%29._input%2Fc%29%29" class="RktValDef RktValLink" data-pltdoc="x">input/c</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/contract-utilities.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fguts..rkt%29._contract~3f%29%29" class="RktValLink" data-pltdoc="x">contract?</a></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Contract for valid input data to an operation such as <span class="RktSym"><a href="digest.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._digest%29%29" class="RktValLink" data-pltdoc="x">digest</a></span>,
<span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._encrypt%29%29" class="RktValLink" data-pltdoc="x">encrypt</a></span>, etc. The operations are defined in terms of bytestrings, but
other values are accepted and converted as following:
</div><div class="SIntrapara"><ul><li><p><span class="RktSym"><a href="http://docs.racket-lang.org/reference/bytestrings.html#%28def._%28%28quote._~23~25kernel%29._bytes~3f%29%29" class="RktValLink" data-pltdoc="x">bytes?</a></span> &#8212;<wbr></wbr> no conversion needed</p></li><li><p><span class="RktSym"><a href="http://docs.racket-lang.org/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" class="RktValLink" data-pltdoc="x">string?</a></span> &#8212;<wbr></wbr> converted to bytes via <span class="RktSym"><a href="http://docs.racket-lang.org/reference/bytestrings.html#%28def._%28%28quote._~23~25kernel%29._string-~3ebytes%2Futf-8%29%29" class="RktValLink" data-pltdoc="x">string-&gt;bytes/utf-8</a></span></p></li><li><p><span class="RktSym"><a href="http://docs.racket-lang.org/reference/port-ops.html#%28def._%28%28quote._~23~25kernel%29._input-port~3f%29%29" class="RktValLink" data-pltdoc="x">input-port?</a></span> &#8212;<wbr></wbr> read until <span class="RktSym"><a href="http://docs.racket-lang.org/reference/port-ops.html#%28def._%28%28quote._~23~25kernel%29._eof%29%29" class="RktValLink" data-pltdoc="x">eof</a></span> is returned (but the port
is not closed)</p></li><li><p><span class="RktSym"><a href="#%28def._%28%28lib._crypto%2Fmain..rkt%29._bytes-range~3f%29%29" class="RktValLink" data-pltdoc="x">bytes-range?</a></span> &#8212;<wbr></wbr> represents a subsequence of a bytestring</p></li><li><p><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._listof%29%29" class="RktValLink" data-pltdoc="x">listof</a></span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._crypto%2Fmain..rkt%29._input%2Fc%29%29" class="RktValLink" data-pltdoc="x">input/c</a></span><span class="RktPn">)</span> &#8212;<wbr></wbr> concatenation of the input elements</p></li></ul></div><div class="SIntrapara">Note that fixed-sized data such as keys, IVs, etc are not represented as
<span class="RktSym"><a href="#%28def._%28%28lib._crypto%2Fmain..rkt%29._input%2Fc%29%29" class="RktValLink" data-pltdoc="x">input/c</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>struct</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" class="RktStxLink" data-pltdoc="x">struct</a></span><span class="stt"> </span><a name="(def._((lib._crypto/main..rkt)._bytes-range-end))"></a><a name="(def._((lib._crypto/main..rkt)._bytes-range-start))"></a><a name="(def._((lib._crypto/main..rkt)._bytes-range-bs))"></a><a name="(def._((lib._crypto/main..rkt)._bytes-range~3f))"></a><a name="(def._((lib._crypto/main..rkt)._struct~3abytes-range))"></a><a name="(def._((lib._crypto/main..rkt)._bytes-range))"></a><span title="Provided from: crypto | Package: crypto-lib"><span class="RktSym"><a href="#%28def._%28%28lib._crypto%2Fmain..rkt%29._bytes-range%29%29" class="RktValDef RktValLink" data-pltdoc="x">bytes-range</a></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">bs</span><span class="stt"> </span><span class="RktSym">start</span><span class="stt"> </span><span class="RktSym">end</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">bs</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/bytestrings.html#%28def._%28%28quote._~23~25kernel%29._bytes~3f%29%29" class="RktValLink" data-pltdoc="x">bytes?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">start</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-nonnegative-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">end</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-nonnegative-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-nonnegative-integer?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Represents a subsequence of a bytestring. See also <span class="RktSym"><a href="#%28def._%28%28lib._crypto%2Fmain..rkt%29._input%2Fc%29%29" class="RktValLink" data-pltdoc="x">input/c</a></span>.</div></p><p>Equivalent to <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/bytestrings.html#%28def._%28%28quote._~23~25kernel%29._subbytes%29%29" class="RktValLink" data-pltdoc="x">subbytes</a></span><span class="stt"> </span><span class="RktSym">bs</span><span class="stt"> </span><span class="RktSym">start</span><span class="stt"> </span><span class="RktSym">end</span><span class="RktPn">)</span> if <span class="RktSym">bs</span> is not
subsequently mutated, but avoids making a copy.</p><h4>7.2<tt>&nbsp;</tt><a name="(part._provider-notes)"></a>Notes on Cryptography Providers</h4><h5>7.2.1<tt>&nbsp;</tt><a name="(part._random)"></a>CSPRNG Initialization</h5><p>Some cryptographic operations require a source of cryptographically
secure pseudo-random numbers. Some of these, such as
<span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._generate-cipher-key%29%29" class="RktValLink" data-pltdoc="x">generate-cipher-key</a></span>, are handled at the Racket level and use
<span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28lib._racket%2Frandom..rkt%29._crypto-random-bytes%29%29" class="RktValLink" data-pltdoc="x">crypto-random-bytes</a></span>. Other operations, such as
<span class="RktSym"><a href="pk.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._generate-private-key%29%29" class="RktValLink" data-pltdoc="x">generate-private-key</a></span>, RSA signing with PSS padding, and many
more, use the crypto provider&rsquo;s internal CSPRNG. This section contains
notes on crypto providers&rsquo; CSPRNG initialization.</p><p><span style="font-weight: bold">libcrypto</span> The libcrypto foreign library automatically seeds its
CSPRNG using entropy obtained from the operating system
(<a href="http://wiki.openssl.org/index.php/Random_Numbers">as
described here</a>).</p><p><span style="font-weight: bold">gcrypt</span> The libgcrypt foreign library seems to perform some
default CSPRNG initialization, but I don&rsquo;t know the details.</p><p><span style="font-weight: bold">nettle</span> The <a href="index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">crypto</span></a> library creates a Yarrow-256
instance and seeds it once with entropy obtained from
<span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28lib._racket%2Frandom..rkt%29._crypto-random-bytes%29%29" class="RktValLink" data-pltdoc="x">crypto-random-bytes</a></span>. The instance does not automatically
update its entropy pool, so it does <span style="font-weight: bold">not</span> enjoy Yarrow&rsquo;s
key-compromise recovery properties.</p><h5>7.2.2<tt>&nbsp;</tt><a name="(part._libcrypto-notes)"></a>Libcrypto Quirks</h5><p>PSS padding for RSA signatures is, in principle, parameterized by the
salt length. A standard choice is the length of the digest to be
signed. By default, libcrypto uses the maximum possible salt length
when signing and infers the salt length when verifying, as documented
for <a href="https://www.openssl.org/docs/manmaster/man3/EVP_PKEY_CTX_set_rsa_pss_saltlen.html">EVP_PKEY_CTX_set_rsa_pss_saltlen</a>.
See also <a href="https://crypto.stackexchange.com/questions/1217/rsa-pss-salt-size">this
discussion</a>. Unfortunately, other libraries do not directly support this behavior and it is nontrivial to work around it.
Thus for greater compatibility, this library defines <span class="RktVal">'</span><span class="RktVal">pss</span>
padding to use the digest length and <span class="RktVal">'</span><span class="RktVal">pss*</span> to be the
libcrypto-specific behavior.</p><h5>7.2.3<tt>&nbsp;</tt><a name="(part._gcrypt-notes)"></a>GCrypt Quirks</h5><p>If ECDSA is used with a digest longer than the bit-length of the
curve, gcrypt either fails to correctly truncate the digest or
otherwise handles it by default in a way incompatible with libcrypto
and nettle. Consequently, this library truncates the digest before
passing it to gcrypt for signing.</p><p>GCrypt does not expose operations to compute EC and EdDSA public keys
from the private keys, so reading a private key in PrivateKeyInfo or
OneAsymmetricKey form may fail if the optional public key field is
missing.</p><h5>7.2.4<tt>&nbsp;</tt><a name="(part._sodium-notes)"></a>Sodium Quirks</h5><p>Sodium provides only &ldquo;all-at-once&rdquo; encryption and decryption
functions. Consequently, encryption and decryption contexts using
sodium ciphers produce no output until <span class="RktSym"><a href="cipher.html#%28def._%28%28lib._crypto%2Fmain..rkt%29._cipher-final%29%29" class="RktValLink" data-pltdoc="x">cipher-final</a></span> is
called.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="kdf.html" title="backward to &quot;6 Key Derivation and Password Hashing&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Crypto: Cryptographic Operations&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>